<!-- 
	Matthew Tsui 
	Playing with HTML5 <video>, <input> slider, drag & drop, etc.


http://thenewcode.com/757/Playing-With-The-HTML5-range-Slider-Input
-->
<!DOCTYPE html>
<html>
<head>
	<title>Vol 2. Video</title>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
	<style>

	body{
		padding:0;
		margin:0;
		height:100vh;
		width:100vw;
		font-family:Helvetica, Arial, sans-serif;	}
	main{
		height:100%;
		width:100%;
		display:flex;
		justify-content:center;
		align-items:center;
		flex-direction:column;
	}

	/* https://stackoverflow.com/questions/826782/css-rule-to-disable-text-selection-highlighting */
	.noselect {
	  -webkit-touch-callout: none; /* iOS Safari */
	  -webkit-user-select: none;   /* Chrome/Safari/Opera */
	  -khtml-user-select: none;    /* Konqueror */
	  -moz-user-select: none;      /* Firefox */
	  -ms-user-select: none;       /* Internet Explorer/Edge */
	  user-select: none;           /* Non-prefixed version, currently
	                                  not supported by any browser */
	}
	#dropzone{
		--c_gray: rgba(0,0,0,0.6);
		width:300px;
		height:200px;
		border:5px dashed var(--c_gray);
		display:flex;
		justify-content: center;
		align-items:center;
		color:var(--c_gray);

	}



	#dropzone input{
		display:none;
	}

	#

	video{
		margin-bottom:20px;
	}
		
	</style>
	<main>
		<div id="video-container">
			<video width="420" id="video" controls>
			
	 		</video>
	 		<nav id="video-controls" class="controls noselect">
			   <li><i id="playpause" class="material-icons">play_arrow</i></li>
			   <li><i id="mute" class="material-icons">volume_up</i></li>
			   <li><button id="stop" type="button">Stop</button></li>
			   <li class="progress">
			      <progress id="progress" value="0" min="0">
			         <span id="progress-bar"></span>
			      </progress>
			   </li>
			   <li><button id="volinc" type="button">Vol+</button></li>
			   <li><button id="voldec" type="button">Vol-</button></li>
			   <li><input id="volume" type="range" max="100" min="0" oninput="updateVolume(value)"></li>
			   <li><span id="volume-val"></span></li>
			   <li><i class="material-icons">settings</i></li>
			   <li><i id="fs" class="material-icons">fullscreen</i></li>
			</nav>
		</div>
		<div id="dropzone">
			Drop a video file...
			<input type="file" id="fileselect" name="fileselect" />

		</div>
	</main>
<script>



	var requestAnimationFrame = window.requestAnimationFrame 		|| 
	                            window.mozRequestAnimationFrame 	|| 
	                            window.webkitRequestAnimationFrame  || 
	                            window.msRequestAnimationFrame;
	
	//get first
	var $ = function(elem){
		return document.querySelector(elem);
	}

	//get array
	var $_ = function(elem){
		return document.querySelectAll(elem);
	}

	
	
	var video = $('#video');

	//WIP: for testing, remove later
	var srcElement = document.createElement('source');
	srcElement.src = 'big_bunny.mp4' //files[0].name;
	srcElement.type = 'video/mp4';//files[0].type;
	video.appendChild(srcElement);


	var volval = $('#volume-val');
	//

	var videoContainer = $('#video-container');
	var customControls = $('#video-controls');
	var volume = $('#volume');
	volume.value = video.volume*100;
	console.log(video.volume);
	customControls.style.display = 'block';
	video.controls = false;

	//Custom Video Controls base code from https://developer.mozilla.org/en-US/Apps/Fundamentals/Audio_and_video_delivery/cross_browser_video_player
	var playpause = document.getElementById('playpause');
	var stop = document.getElementById('stop');
	var mute = document.getElementById('mute');
	var volinc = document.getElementById('volinc');
	var voldec = document.getElementById('voldec');
	var progress = document.getElementById('progress');
	var progressBar = document.getElementById('progress-bar');
	var fullscreen = document.getElementById('fs');

	playpause.addEventListener('click', function(e) {
	    if (video.paused || video.ended){
	   		video.play();
	   		playpause.innerHTML = 'play_arrow';

	    }else{
	    	playpause.innerHTML = 'pause';
	    	video.pause();
	    } 
	});

	stop.addEventListener('click', function(e) {
	   video.pause();
	   video.currentTime = 0;
	   progress.value = 0;
	});

	mute.addEventListener('click', function(e) {
	   video.muted = !video.muted;
	   if(video.muted){
	   		mute.innerHTML = 'volume_off';
	   }else{
	   		mute.innerHTML = 'volume_up';
	   }
	});

	volinc.addEventListener('click', function(e) {
	   alterVolume('+');
	});
	voldec.addEventListener('click', function(e) {
	   alterVolume('-');
	});

	var alterVolume = function(dir) {
	   var currentVolume = Math.floor(video.volume * 10) / 10;
	   if (dir === '+') {
	      if (currentVolume < 1) video.volume += 0.1;
	   }
	   else if (dir === '-') {
	      if (currentVolume > 0) video.volume -= 0.1;
	   }
	   volume.value = video.volume*100;
	   volval.innerHTML = video.volume;
	}

	function updateVolume(val){
		video.volume = val/100;
		volval.innerHTML = video.volume;
	}

	video.addEventListener('loadedmetadata', function() {
	   progress.setAttribute('max', video.duration);
	});


	video.addEventListener('timeupdate', function() {
	   if (!progress.getAttribute('max')) progress.setAttribute('max', video.duration);
	   progress.value = video.currentTime;
	   progressBar.style.width = Math.floor((video.currentTime / video.duration) * 100) + '%';
	});

	progress.addEventListener('click', function(e) {
	   var pos = (e.pageX  - this.offsetLeft) / this.offsetWidth;
	   video.currentTime = pos * video.duration;
	});

	var fullScreenEnabled = !!(document.fullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled || document.webkitSupportsFullscreen || document.webkitFullscreenEnabled || document.createElement('video').webkitRequestFullScreen);

	if (!fullScreenEnabled) {
	   fullscreen.style.display = 'none';
	}

	fullscreen.addEventListener('click', function(e) {
	   handleFullscreen();
	});

	var handleFullscreen = function() {
	   if (isFullScreen()) {
	      if (document.exitFullscreen) document.exitFullscreen();
	      else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
	      else if (document.webkitCancelFullScreen) document.webkitCancelFullScreen();
	      else if (document.msExitFullscreen) document.msExitFullscreen();
	      fullscreen.innerHTML = 'fullscreen';
	      setFullscreenData(false);
	   }
	   else {
	      if (videoContainer.requestFullscreen) videoContainer.requestFullscreen();
	      else if (videoContainer.mozRequestFullScreen) videoContainer.mozRequestFullScreen();
	      else if (videoContainer.webkitRequestFullScreen) videoContainer.webkitRequestFullScreen();
	      else if (videoContainer.msRequestFullscreen) videoContainer.msRequestFullscreen();
	      fullscreen.innerHTML = 'fullscreen_exit';
	      setFullscreenData(true);
	   }
	}

	var isFullScreen = function() {
	   return !!(document.fullScreen || document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement || document.fullscreenElement);
	}

	var setFullscreenData = function(state) {
	   videoContainer.setAttribute('data-fullscreen', !!state);
	}

	document.addEventListener('fullscreenchange', function(e) {
	   setFullscreenData(!!(document.fullScreen || document.fullscreenElement));
	});
	document.addEventListener('webkitfullscreenchange', function() {
	   setFullscreenData(!!document.webkitIsFullScreen);
	});
	document.addEventListener('mozfullscreenchange', function() {
	   setFullscreenData(!!document.mozFullScreen);
	});
	document.addEventListener('msfullscreenchange', function() {
	   setFullscreenData(!!document.msFullscreenElement);
	});


	//Modified code from https://www.sitepoint.com/html5-file-drag-and-drop/
	var dropzone = $('#dropzone');
	dropzone.addEventListener('dragover', FileDragHover, false);
	dropzone.addEventListener('dragleave', FileDragHover, false);
	dropzone.addEventListener('drop', FileSelectHandler, false);

	function FileDragHover(e) {
		e.stopPropagation();
		e.preventDefault();
		e.target.className = (e.type == 'dragover' ? 'hover' : '');
	}

	function FileSelectHandler(e) {

		// cancel event and hover styling
		FileDragHover(e);
		// // fetch FileList object
		 var files = e.target.files || e.dataTransfer.files;

		console.log(files);

		// // process all File objects
		// for (var i = 0, f; f = files[i]; i++) {
		// 	ParseFile(f);
		// }

		


		var srcElement = document.createElement('source');
		srcElement.src = files[0].name;
		srcElement.type = files[0].type;
		video.appendChild(srcElement);

	}

</script>
</body>
</html>
